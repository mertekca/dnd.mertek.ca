<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Character Sheet</title>
    <style>
        body { font-family: Arial, sans-serif; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .section { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Upload a D&D Character Sheet</h1>
    <input type="file" id="fileInput" accept="application/json">
    <div id="sheetContainer"></div>

    <script>
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    displayCharacterSheet(data);
                } catch (error) {
                    alert('Invalid JSON file');
                }
            };
            reader.readAsText(file);
        });

        function formatKey(key) {
            return key.replace(/([A-Z])/g, ' $1')
                      .replace(/^./, str => str.toUpperCase())
                      .replace("Hp", "HP");
        }

        function createCheckboxes(name, count) {
            let checkboxes = '';
            for (let i = 0; i < 3; i++) {
                checkboxes += `<input type="checkbox" name="${name}" ${i < count ? 'checked' : ''}>`;
            }
            return checkboxes;
        }

        function calculateProficiencyBonus(level) {
            return Math.ceil(level / 4) + 1;
        }

        function calculateSkillModifier(abilityScore, proficiency, proficiencyBonus) {
            const abilityModifier = Math.floor((abilityScore - 10) / 2);
            return abilityModifier + (proficiency * proficiencyBonus);
        }

        function displayCharacterSheet(data) {
            const container = document.getElementById('sheetContainer');
            container.innerHTML = '';

            function createSection(title, content) {
                const section = document.createElement('div');
                section.classList.add('section');
                section.innerHTML = `<h3>${title}</h3>${content}`;
                return section;
            }

            let coreInfo = '<table>';
            for (const key in data.main.core) {
                coreInfo += `<tr><th>${formatKey(key)}</th><td>${data.main.core[key]}</td></tr>`;
            }

            // Add proficiency bonus to core info
            const proficiencyBonus = calculateProficiencyBonus(data.main.core.level);
            coreInfo += `<tr><th>Proficiency Bonus</th><td>${proficiencyBonus}</td></tr>`;
            
            coreInfo += '</table>';
            container.appendChild(createSection('Core Information', coreInfo));

            let combatInfo = '<table>';
            for (const key in data.main.combat) {
                if (key === 'deathSaves') {
                    combatInfo += `<tr><th>Death Saves</th><td>Success: ${createCheckboxes('deathSuccess', data.main.combat.deathSaves.success)} Failure: ${createCheckboxes('deathFailure', data.main.combat.deathSaves.failure)}</td></tr>`;
                } else if (key === 'ammunition') {
                    combatInfo += `<tr><th>Ammunition</th><td>Bullets: ${data.main.combat.ammunition.bullets}<br>Arrows: ${data.main.combat.ammunition.arrows}</td></tr>`;
                } else {
                    combatInfo += `<tr><th>${formatKey(key)}</th><td>${data.main.combat[key]}</td></tr>`;
                }
            }
            combatInfo += '</table>';
            container.appendChild(createSection('Combat Stats', combatInfo));

            let statsInfo = '<table>';
            for (const key in data.main.stats) {
                const modifier = Math.floor((data.main.stats[key].score - 10) / 2);
                statsInfo += `<tr><th>${formatKey(key)}</th></tr><tr><td>${data.main.stats[key].score}</td></tr><tr><td>${modifier >= 0 ? '+' : ''}${modifier}</td></tr>`;
            }
            statsInfo += '</table>';
            container.appendChild(createSection('Ability Scores', statsInfo));

            let savingThrowsInfo = '<table>';
            for (const key in data.main.stats) {
                savingThrowsInfo += `<tr><th>${formatKey(key)}</th><td>Proficiency: ${data.main.stats[key].savingProf}, Misc: ${data.main.stats[key].savingMisc}</td></tr>`;
            }
            savingThrowsInfo += '</table>';
            container.appendChild(createSection('Saving Throws', savingThrowsInfo));

            // Hardcoded skills and corresponding abilities
            const skillList = [
                { name: 'Acrobatics', ability: 'DEX', proficiency: data.main.skills.acrobatics },
                { name: 'Animal Handling', ability: 'WIS', proficiency: data.main.skills.animalHandling },
                { name: 'Arcana', ability: 'INT', proficiency: data.main.skills.arcana },
                { name: 'Athletics', ability: 'STR', proficiency: data.main.skills.athletics },
                { name: 'Deception', ability: 'CHA', proficiency: data.main.skills.deception },
                { name: 'History', ability: 'INT', proficiency: data.main.skills.history },
                { name: 'Insight', ability: 'WIS', proficiency: data.main.skills.insight },
                { name: 'Intimidation', ability: 'CHA', proficiency: data.main.skills.intimidation },
                { name: 'Medicine', ability: 'WIS', proficiency: data.main.skills.medicine },
                { name: 'Nature', ability: 'INT', proficiency: data.main.skills.nature },
                { name: 'Perception', ability: 'WIS', proficiency: data.main.skills.perception },
                { name: 'Performance', ability: 'CHA', proficiency: data.main.skills.performance },
                { name: 'Persuasion', ability: 'CHA', proficiency: data.main.skills.persuasion },
                { name: 'Religion', ability: 'INT', proficiency: data.main.skills.religion },
                { name: 'Sleight of Hand', ability: 'DEX', proficiency: data.main.skills.sleightOfHand },
                { name: 'Stealth', ability: 'DEX', proficiency: data.main.skills.stealth },
                { name: 'Survival', ability: 'WIS', proficiency: data.main.skills.survival }
            ];

            let skillsInfo = '<table>';
            skillList.forEach(skill => {
                const abilityScore = data.main.stats[skill.ability].score;
                const skillModifier = calculateSkillModifier(abilityScore, skill.proficiency, proficiencyBonus);
                skillsInfo += `<tr><th>${formatKey(skill.name)}</th><td>${skillModifier >= 0 ? '+' : ''}${skillModifier}</td></tr>`;
            });
            skillsInfo += '</table>';
            container.appendChild(createSection('Skills', skillsInfo));

            let weaponsInfo = '<table>';
            for (const weapon in data.main.weapons) {
                const w = data.main.weapons[weapon];
                weaponsInfo += `<tr><th>${weapon}</th><td>Hit: ${w.hit}, Damage: ${w.damage.diceAmount}${w.damage.dice} + ${w.damage.bonusDamage}, Type: ${w.type}</td></tr>`;
            }
            weaponsInfo += '</table>';
            container.appendChild(createSection('Weapons', weaponsInfo));
        }
    </script>
</body>
</html>
